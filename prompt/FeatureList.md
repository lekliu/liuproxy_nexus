# LiuProxy v3.0 - 功能需求清单

本文档详细列出了`LiuProxy v3.0`项目的所有功能需求，并跟踪其开发状态。

**状态说明**:
*   ✅ **已完成**: 功能已实现并通过验收。
*   📝 **待开发**: 功能已规划，但尚未开始编码。
*   🔄 **进行中**: 功能正在开发或重构中。

---

### **P1: `AppServer` (Web UI 与控制核心)**

| ID | 功能描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- |
| **WEB-01** | **内嵌Web服务** | ✅ **已完成** | 程序能独立提供Web管理界面。 |
| **WEB-02** | **服务器配置管理 (CRUD)** | ✅ **已完成** | UI提供对`servers.json`的增、删、改、查功能。 |
| **WEB-03** | **策略实例管理** | ✅ **已完成** | 实例管理将重构，移除对`localPort`的依赖，改为直接方法调用。 |
| **WEB-04** | **路由规则在线管理** | ✅ **已完成** | UI支持对路由规则进行可视化的、即时保存的CRUD、排序和过滤。 |
| **WEB-05** | **网关参数在线管理** | ✅ **已完成** | UI支持在线配置粘性会话和负载均衡策略。 |
| **WEB-06** | **实时状态监控** | ✅ **已完成** | UI通过API实时显示各策略实例健康状态、并发数和延迟。 |
| **WEB-07** | **防火墙规则在线管理** | ✅ **已完成** | UI将支持对防火墙规则的配置。 |
| **WEB-08** | **实时流量监控** | 📝 **待开发** | UI将新增 "Monitor" 页面，实时显示通过网关的连接流。 |
| **WEB-09** | **Web UI登录认证** | ✅ **已完成** | 已支持基于`liuproxy.ini`配置的HTTP Basic Auth。 |
| **WEB-10** | **服务器配置复制功能** | ✅ **已完成** | UI支持一键复制现有服务器配置，以快速创建相似的节点。 |
---

### **P2: `Gateway` & `Dispatcher` (核心功能)**

| ID | 功能描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- |
| **GW-01** | **转发代理入口 (Forward Proxy)** | ✅ **已完成** | `Gateway`能监听统一端口，正确嗅探并处理SOCKS5和HTTP代理请求。 |
| **GW-02** | **透明代理入口 (Transparent Proxy)** | ✅ **已完成** | 新增的`TransparentGateway`将能处理被`iptables`重定向的流量，并获取原始目标地址。 |
| **GW-03** | **防火墙功能** | ✅ **已完成** | 支持基于IP、端口、协议的状态化包过滤（放行/丢弃）。 |
| **GW-04** | **后端协议支持** | ✅ **已完成** | 策略实例能稳定连接`Go Remote`, `Worker`, `VLESS`后端。 |
| **GW-05** | **智能路由 (`Dispatcher`)** | ✅ **已完成** | 支持基于数值优先级的、包含源IP/目标IP/域名的复杂路由规则。 |
| **GW-06** | **负载均衡** | ✅ **已完成** | 支持“最少连接数”和“轮询”策略，并可在线切换。 |
| **GW-07** | **会话保持 (Sticky Session)** | ✅ **已完成** | 支持基于(源IP, 目标主机)的粘性会话，并可在线配置。 |
| **GW-08** | **健康检查与故障转移** | ✅ **已完成** | `AppServer`能自动检测实例可用性，`Dispatcher`能据此进行容错。 |

---

### **P3: `liuproxy-android-app` (移动端)**

| ID | 功能描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- |
| **APP-01** | **Go核心集成** | ✅ **已完成** | `.aar`库能被App成功调用。 |
| **APP-02** | **VPN服务** | ✅ **已完成** | 使用`VpnService`捕获设备流量。 |
| **APP-03** | **服务器配置管理** | ✅ **已完成** | UI支持对所有后端协议的CRUD和激活。 |
| **APP-04** | **分应用代理** | ✅ **已完成** | 支持白名单和黑名单模式。 |
| **APP-05** | **延迟测试与流量统计** | ✅ **已完成** | 在UI和通知栏显示延迟和实时速度。 |
| **APP-06** | **订阅功能** | 📝 **待开发** | 支持通过URL添加和更新服务器列表。 |

---

### **P4: 系统级特性 (跨模块)**

| ID | 功能描述 | 状态 | 备注 |
| :--- | :--- | :--- | :--- |
| **SYS-01** | **Docker化部署** | 🔄 **进行中** | 将创建支持`NET_ADMIN`的单一Go进程的`Dockerfile`，并包含启动脚本。 |
| **SYS-02** | **结构化日志** | ✅ **已完成** | 已引入`zerolog`，实现了可配置的结构化日志。 |
| **SYS-03** | **自动化测试** | 📝 **待开发** | 建立单元测试和端到端集成测试框架。 |
| **SYS-04** | **部署文档** | 🔄 **进行中** | 将更新文档，增加“传统网关模式”的部署说明。 |